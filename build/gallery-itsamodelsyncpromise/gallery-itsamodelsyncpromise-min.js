YUI.add("gallery-itsamodelsyncpromise",function(e,t){"use strict";function a(){}var n=e.Array,r="error",i="submit",s="load",o="save",u=function(t){if(typeof t=="string")try{return e.JSON.parse(t)}catch(n){return this.fire(r,{error:n,response:t,src:"parse"}),null}return t};e.mix(a.prototype,{submitPromise:function(t){var n=this;return t=t||{},new e.Promise(function(e,r){var s,o,u={options:t};s=function(e){u.error=e,u.src="Model.submitPromise()",n._lazyFireErrorEvent(u),r(new Error(e))},o=function(t){n._submitEvent||(n._submitEvent=n.publish(i,{preventable:!1})),u.response=t,n.fire(i,u),e(t)},n.syncPromise?n.syncPromise("submit",t).then(o,s):n.sync("submit",t,function(e,t){e?s(e):o(t)})})},loadPromise:function(t){var n=this;return t=t||{},new e.Promise(function(e,r){var i,o,a={options:t};i=function(e){a.error=e,a.src="Model.loadPromise()",n._lazyFireErrorEvent(a),r(new Error(e))},o=function(r){var i;n._loadEvent||(n._loadEvent=n.publish(s,{preventable:!1})),a.response=r,i=a.parsed=u(r),n.setAttrs(i,t),n.changed={},n.fire(s,a),e(r)},n.syncPromise?n.syncPromise("read",t).then(o,i):n.sync("read",t,function(e,t){e?i(e):o(t)})})},savePromise:function(t){var n=this;return t=t||{},new e.Promise(function(e,r){var i,s,a,f={options:t};n._validate(n.toJSON(),function(l){l?(f.error=l,f.src="Model.savePromise() - validate",n._lazyFireErrorEvent(f),r(new Error(l))):(i=function(e){f.error=e,f.src="Model.savePromise()",n._lazyFireErrorEvent(f),r(new Error(e))},s=function(r){var i;n._saveEvent||(n._saveEvent=n.publish(o,{preventable:!1})),f.response=r,i=f.parsed=u(r),n.setAttrs(i,t),n.changed={},n.fire(o,f),e(r)},a=n.isNew()?"create":"update",n.syncPromise?n.syncPromise(a,t).then(s,i):n.sync(a,t,function(e,t){e?i(e):s(t)}))})})},destroyPromise:function(t){var r=this;return t=t||{},(new e.Promise(function(e,i){r.onceAfter("destroy",function(){var s,o,u;u=function(){n.each(r.lists.concat(),function(e){e.remove(r,t)})},t.remove||t["delete"]?(s=function(e){var n={error:e,src:"Model.destroyPromise()",options:t};r._lazyFireErrorEvent(n),i(new Error(e))},o=function(t){u(),e(t)},r.syncPromise?r.syncPromise("delete",t).then(o,s):r.sync("delete",t,function(e,t){e?s(e):o(t)})):(u(),e())})})).then(function(){e.Model.superclass.destroy.call(r)})},_lazyFireErrorEvent:function(e){var t=this;t._errorEvent||(t._errorEvent=t.publish(r,{broadcast:1})),t.fire(r,e)}},!0),e.ITSAModelSyncPromise=a,e.Base.mix(e.Model,[a])},"gallery-2013.06.26-23-09",{requires:["yui-base","base-base","base-build","node-base","json-parse","promise","model"]});
