YUI.add("gallery-composite-image",function(e,t){(function(e){"use strict";var t="f32",n="f64",r="s16",i="s32",s="s8",o="u16",u="u32",a="u8",f=ArrayBuffer,l=DataView,c=e.Lang,h=Object,p=e.Array,d=e.cached,v=h.defineProperties,m=p.each,g=p.flatten,y=h.freeze,b=c.isArray,w=p.map,E=p.reduce,S=function(){this._init.apply(this,arguments)};e.namespace("Composite").Image=e.mix(S,{dataTypes:{f32:t,f64:n,s16:r,s32:i,s8:s,u16:o,u32:u,u8:a},defaultChannels:[a,a,a,a],defaultDimensions:[512,512],prototype:{clear:function(){var e=this;return e._data=new f(e.pixelCount*e._pixelSize),e},clone:function(){var e=this;return new S({channels:e.channels,data:e._data.slice(),dimensions:e.dimensions,littleEndian:e._littleEndian})},eachPixelIndex:function(e){var t=this.pixelCount,n=0;for(;n<t;n+=1)e(n);return this},eachPixelLocation:function(e){var t=this.dimensions,n=t.length,r=0,i=this.pixelCount,s=0,o=[];for(;r<n;r+=1)o[r]=0;for(;s<i;s+=1){e(o.slice(),s);for(r=0;r<n;r+=1){o[r]+=1;if(o[r]<t[r])break;o[r]=0}}return this},getDataArray:function(){var e=this,t=e._dataView;return t instanceof l?function(){var t=e.channels.length,n=[];return e.eachPixelIndex(function(r){for(var i=0;i<t;i+=1)n.push(e.getValue(r,i))}),n}():p(t)},getPixelIndex:function(){return this._getPixelIndex.apply(this,g(arguments))},getPixelValues:function(e,t){var n=this;return w(t||n.channels,t?function(t){return n.getValue(e,t)}:function(t,r){return n.getValue(e,r)})},getValue:function(e,t){return this._getValue(b(e)?this.getPixelIndex(e):e,t)},setDataArray:function(e){var t=this,n=t.channels.length,r=0;return t.eachPixelIndex(function(i){for(var s=0;s<n;s+=1)t.setValue(i,s,e[r]),r+=1})},setPixelValues:function(e,t,n){var r=this;return m(n||t,n?function(n,i){r.setValue(e,n,t[i])}:function(t,n){r.setValue(e,n,t)}),r},setValue:function(e,t,n){return this._setValue(b(e)?this.getPixelIndex(e):e,t,n)},toJSON:function(){var e=this,t=e._littleEndian,n={channels:e.channels,data:e.getDataArray(),dimensions:e.dimensions};return t&&(n.littleEndian=t),n},toString:function(){return"image["+this.dimensions.join("x")+"] "+this.channels},validate:function(e){return e=e||this._data,e instanceof f&&e.byteLength===this.pixelCount*this._pixelSize},_init:function(e){e=e||{};var t=this,n=y((e.channels||S.defaultChannels).slice()),r=[],i,s=y((e.dimensions||S.defaultDimensions).slice()),o=E(s,1,function(e,t){return e*t}),u=E(n,0,function(e,t){return r.push(e),!i&&i!==null?i=t:i&&i!==t&&(i=null),e+ +t.substr(1)/8}),a=e.data,f;v(t,{channels:{enumerable:!0,value:n},dimensions:{enumerable:!0,value:s},pixelCount:{enumberable:!0,value:o},_channelOffsets:{enumerable:!0,value:y(r)},_data:{enumerable:!0,get:function(){return f},set:function(e){f=e,t._dataView=S._getDataView(f,i)}},_dataType:{enumerable:!0,value:i},_pixelSize:{enumerable:!0,value:u}}),t._getPixelIndex=S._getGetPixelIndexMethod.apply(t,s),t._getValue=S._getGetValueMethod(r,u,i),t._setValue=S._getSetValueMethod(r,u,i),t.validate(a)?t._data=a:(t.clear(),b(a)&&t.setDataArray(a)),t._littleEndian=!!e.littleEndian}},_getDataView:function(e,t){return new(S._getDataViewConstructor(t))(e)},_getDataViewConstructor:d(function(e){switch(e){case t:return Float32Array;case n:return Float64Array;case r:return Int16Array;case i:return Int32Array;case s:return Int8Array;case o:return Uint16Array;case u:return Uint32Array;case a:return Uint8ClampedArray}return l}),_getGetPixelIndexMethod:d(function(){var e=arguments,t=e.length;return d(function(){var n=arguments,r,i=0,s,o;for(r=0;r<t;r+=1){o=n[r];for(s=r-1;s>=0;s-=1)o*=e[s];i+=o}return i})}),_getGetValueMethod:d(function(e,t,n){var r=e.length;return n?function(e,t){return this._dataView[e*r+t]}:function(n,r){return this._dataView["get"+S._getTypeName(this.channels[r])](n*t+e[r],this.littleEndian)}}),_getSetValueMethod:d(function(e,t,n){var r=e.length;return n?function(e,t,n){return this._dataView[e*r+t]=n,this}:function(n,r,i){var s=this;return s._dataView["set"+S._getTypeName(s.channels[r])](n*t+e[r],i,s.littleEndian),s}}),_getTypeName:d(function(e){var t=e.charAt(0);return(t==="f"?"Float":t==="s"?"Int":"Uint")+e.substr(1)})},!0)})(e)},"gallery-2012.12.19-21-23",{requires:["array-extras"]});
